{% extends 'base.html' %}
{% load humanize %}
{% block title %}Dashboard de Finanzas Personales | Tu Resumen Financiero{% endblock %}
{% block content %}
{% load static %}

{# Contenedor Principal Unificado #}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">

    <h1 class="text-3xl font-bold text-gray-800 mb-8">Tu Resumen Financiero</h1>

    {# --- Filtros --- #}
    {# La clase 'mb-8' (margin-bottom) controla el espacio hacia la siguiente sección #}
    <div class="bg-white p-4 rounded-lg shadow-md mb-8">
        <form method="GET" action="" class="grid grid-cols-1 sm:grid-cols-3 items-end gap-4">
            <div class="sm:col-span-1">
                <label for="month" class="block text-sm font-medium text-gray-700">Mes:</label>
                <select name="month" id="month" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    {% for m in months %}
                        <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="sm:col-span-1">
                <label for="year" class="block text-sm font-medium text-gray-700">Año:</label>
                <select name="year" id="year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    {% for y in years %}
                        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="sm:col-span-1">
                <button type="submit" class="w-full justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Filtrar
                </button>
            </div>
        </form>
    </div>

    {# --- Resumen del Mes --- #}
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Resumen del Mes</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Ingresos (Mes)</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ ingresos|floatformat:2 | intcomma }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Gastos (Mes)</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ gastos|floatformat:2 | intcomma }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Disponible Banco</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ disponible_banco|floatformat:2 | intcomma }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Balance (Mes)</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ balance|floatformat:2 | intcomma }}</p>
        </div>
    </div>
    
    {# --- Gráficas --- #}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-semibold text-lg text-gray-700 mb-4">Gastos por Categoría (Mes)</h3>
            <div class="relative h-150">
                <canvas id="gastosPorCategoriaChart" data-url="{% url 'api_datos_gastos' %}?year={{ selected_year }}&month={{ selected_month }}"></canvas>
            </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-semibold text-lg text-gray-700 mb-4">Ingresos vs. Gastos (Mes)</h3>
            <div class="relative h-150">
                <canvas id="flujoDeDineroChart" data-url="{% url 'api_flujo_dinero' %}?year={{ selected_year }}&month={{ selected_month }}"></canvas>
            </div>
        </div>
    </div>

    {# --- Patrimonio e Inversiones --- #}
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Patrimonio</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-teal-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Ahorro</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ ahorro|floatformat:2 | intcomma }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Inversion Inicial (USD)</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ inversion_inicial|floatformat:2 | intcomma }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-indigo-500">
            <h3 class="text-sm font-medium text-gray-500 uppercase">Inversion Actual (USD)</h3>
            <p class="mt-2 text-3xl font-semibold text-gray-900">${{ inversion_actual|floatformat:2 | intcomma}}</p>
        </div>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="font-semibold text-lg text-gray-700 mb-4">Evolución del Capital Invertido</h3>
        <div class="relative h-150">
            <canvas id="investmentLineChart" data-url="{% url 'api_ganancias_mensuales' %}"></canvas>
        </div>
    </div>

</div>

{% block javascript %}
    <script src="{% static 'js/dashboard_charts.js' %}"></script>
{% endblock javascript %}
{% endblock %}